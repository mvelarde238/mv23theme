/*! gjs-context-menu - 1.0.145 */
!function(t,e){'object'==typeof exports&&'object'==typeof module?module.exports=e(require("Backbone")):'function'==typeof define&&define.amd?define(["Backbone"],e):'object'==typeof exports?exports["gjs-context-menu"]=e(require("Backbone")):t["gjs-context-menu"]=e(t["Backbone"])}('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this,t=>(()=>{var e={36:function(t,e,n){!function(e,i){1&&t.exports?t.exports=i(e,n(348),n(649)):e.Draggabilly=i(e,e.getSize,e.Unidragger)}('undefined'!=typeof window?window:this,function(t,e,n){let i=t.jQuery;function o(t,e){this.element='string'==typeof t?document.querySelector(t):t,i&&(this.$element=i(this.element)),this.options={},this.option(e),this._create()}let r=o.prototype=Object.create(n.prototype);r.option=function(t){this.options={...this.options,...t}};const s=['relative','absolute','fixed'];r._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition={...this.position};let t=getComputedStyle(this.element);s.includes(t.position)||(this.element.style.position='relative'),this.on('pointerDown',this.handlePointerDown),this.on('pointerUp',this.handlePointerUp),this.on('dragStart',this.handleDragStart),this.on('dragMove',this.handleDragMove),this.on('dragEnd',this.handleDragEnd),this.setHandles(),this.enable()},r.setHandles=function(){let{handle:t}=this.options;'string'==typeof t?this.handles=this.element.querySelectorAll(t):'object'==typeof t&&t.length?this.handles=t:t instanceof HTMLElement?this.handles=[t]:this.handles=[this.element]};const l=['dragStart','dragMove','dragEnd'];let c=r.emitEvent;function a(t,e,n){return e?(n=n||'round',Math[n](t/e)*e):t}r.emitEvent=function(e,n){if(!this.isEnabled&&l.includes(e))return;c.call(this,e,n);let i,o=t.jQuery;if(!o||!this.$element)return;let r=n;n&&n[0]instanceof Event&&([i,...r]=n);let s=o.Event(i);s.type=e,this.$element.trigger(s,r)},r._getPosition=function(){let t=getComputedStyle(this.element),e=this._getPositionCoord(t.left,'width'),n=this._getPositionCoord(t.top,'height');this.position.x=isNaN(e)?0:e,this.position.y=isNaN(n)?0:n,this._addTransformPosition(t)},r._getPositionCoord=function(t,n){if(t.includes('%')){let i=e(this.element.parentNode);return i?parseFloat(t)/100*i[n]:0}return parseInt(t,10)},r._addTransformPosition=function(t){let e=t.transform;if(!e.startsWith('matrix'))return;let n=e.split(','),i=e.startsWith('matrix3d')?12:4,o=parseInt(n[i],10),r=parseInt(n[i+1],10);this.position.x+=o,this.position.y+=r},r.handlePointerDown=function(t,e){this.isEnabled&&(this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY},t.preventDefault(),document.activeElement.blur(),this.bindActivePointerEvents(t),this.element.classList.add('is-pointer-down'))},r.handleDragStart=function(){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add('is-dragging'),this.animate())},r.measureContainment=function(){let t=this.getContainer();if(!t)return;let n=e(this.element),i=e(t),{borderLeftWidth:o,borderRightWidth:r,borderTopWidth:s,borderBottomWidth:l}=i,c=this.element.getBoundingClientRect(),a=t.getBoundingClientRect(),u=o+r,d=s+l,h=this.relativeStartPosition={x:c.left-(a.left+o),y:c.top-(a.top+s)};this.containSize={width:i.width-u-h.x-n.width,height:i.height-d-h.y-n.height}},r.getContainer=function(){let t=this.options.containment;if(t)return t instanceof HTMLElement?t:'string'==typeof t?document.querySelector(t):this.element.parentNode},r.handleDragMove=function(t,e,n){if(!this.isEnabled)return;let i=n.x,o=n.y,r=this.options.grid,s=r&&r[0],l=r&&r[1];i=a(i,s),o=a(o,l),i=this.containDrag('x',i,s),o=this.containDrag('y',o,l),i='y'==this.options.axis?0:i,o='x'==this.options.axis?0:o,this.position.x=this.startPosition.x+i,this.position.y=this.startPosition.y+o,this.dragPoint.x=i,this.dragPoint.y=o},r.containDrag=function(t,e,n){if(!this.options.containment)return e;let i='x'==t?'width':'height',o=a(-this.relativeStartPosition[t],n,'ceil'),r=this.containSize[i];return r=a(r,n,'floor'),Math.max(o,Math.min(r,e))},r.handlePointerUp=function(){this.element.classList.remove('is-pointer-down')},r.handleDragEnd=function(){this.isEnabled&&(this.element.style.transform='',this.setLeftTop(),this.element.classList.remove('is-dragging'))},r.animate=function(){this.isDragging&&(this.positionDrag(),requestAnimationFrame(()=>this.animate()))},r.setLeftTop=function(){let{x:t,y:e}=this.position;this.element.style.left=`${t}px`,this.element.style.top=`${e}px`},r.positionDrag=function(){let{x:t,y:e}=this.dragPoint;this.element.style.transform=`translate3d(${t}px, ${e}px, 0)`},r.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.setLeftTop()},r.enable=function(){this.isEnabled||(this.isEnabled=!0,this.bindHandles())},r.disable=function(){this.isEnabled&&(this.isEnabled=!1,this.isDragging&&this.dragEnd(),this.unbindHandles())};const u=['transform','left','top','position'];return r.destroy=function(){this.disable(),u.forEach(t=>{this.element.style[t]=''}),this.unbindHandles(),this.$element&&this.$element.removeData('draggabilly')},r._init=function(){},i&&i.bridget&&i.bridget('draggabilly',o),o})},184:function(t){!function(e,n){1&&t.exports?t.exports=n():e.EvEmitter=n()}('undefined'!=typeof window?window:this,function(){function t(){}let e=t.prototype;return e.on=function(t,e){if(!t||!e)return this;let n=this._events=this._events||{},i=n[t]=n[t]||[];return i.includes(e)||i.push(e),this},e.once=function(t,e){if(!t||!e)return this;this.on(t,e);let n=this._onceEvents=this._onceEvents||{};return(n[t]=n[t]||{})[e]=!0,this},e.off=function(t,e){let n=this._events&&this._events[t];if(!n||!n.length)return this;let i=n.indexOf(e);return-1!=i&&n.splice(i,1),this},e.emitEvent=function(t,e){let n=this._events&&this._events[t];if(!n||!n.length)return this;n=n.slice(0),e=e||[];let i=this._onceEvents&&this._onceEvents[t];for(let o of n){i&&i[o]&&(this.off(t,o),delete i[o]),o.apply(this,e)}return this},e.allOff=function(){return delete this._events,delete this._onceEvents,this},t})},348:t=>{!function(e,n){1&&t.exports?t.exports=n():e.getSize=n()}(window,function(){function t(t){let e=parseFloat(t);return-1==t.indexOf('%')&&!isNaN(e)&&e}let e=['paddingLeft','paddingRight','paddingTop','paddingBottom','marginLeft','marginRight','marginTop','marginBottom','borderLeftWidth','borderRightWidth','borderTopWidth','borderBottomWidth'];e.length;return function(n){if('string'==typeof n&&(n=document.querySelector(n)),!(n&&'object'==typeof n&&n.nodeType))return;let i=getComputedStyle(n);if('none'==i.display)return function(){let t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};return e.forEach(e=>{t[e]=0}),t}();let o={};o.width=n.offsetWidth,o.height=n.offsetHeight;let r=o.isBorderBox='border-box'==i.boxSizing;e.forEach(t=>{let e=i[t],n=parseFloat(e);o[t]=isNaN(n)?0:n});let s=o.paddingLeft+o.paddingRight,l=o.paddingTop+o.paddingBottom,c=o.marginLeft+o.marginRight,a=o.marginTop+o.marginBottom,u=o.borderLeftWidth+o.borderRightWidth,d=o.borderTopWidth+o.borderBottomWidth,h=t(i.width);!1!==h&&(o.width=h+(r?0:s+u));let f=t(i.height);return!1!==f&&(o.height=f+(r?0:l+d)),o.innerWidth=o.width-(s+u),o.innerHeight=o.height-(l+d),o.outerWidth=o.width+c,o.outerHeight=o.height+a,o}})},453:e=>{"use strict";e.exports=t},649:function(t,e,n){!function(e,i){1&&t.exports?t.exports=i(e,n(184)):e.Unidragger=i(e,e.EvEmitter)}('undefined'!=typeof window?window:this,function(t,e){function n(){}let i,o,r=n.prototype=Object.create(e.prototype);r.handleEvent=function(t){let e='on'+t.type;this[e]&&this[e](t)},'ontouchstart'in t?(i='touchstart',o=['touchmove','touchend','touchcancel']):t.PointerEvent?(i='pointerdown',o=['pointermove','pointerup','pointercancel']):(i='mousedown',o=['mousemove','mouseup']),r.touchActionValue='none',r.bindHandles=function(){this._bindHandles('addEventListener',this.touchActionValue)},r.unbindHandles=function(){this._bindHandles('removeEventListener','')},r._bindHandles=function(e,n){this.handles.forEach(o=>{o[e](i,this),o[e]('click',this),t.PointerEvent&&(o.style.touchAction=n)})},r.bindActivePointerEvents=function(){o.forEach(e=>{t.addEventListener(e,this)})},r.unbindActivePointerEvents=function(){o.forEach(e=>{t.removeEventListener(e,this)})},r.withPointer=function(t,e){e.pointerId===this.pointerIdentifier&&this[t](e,e)},r.withTouch=function(t,e){let n;for(let t of e.changedTouches)t.identifier===this.pointerIdentifier&&(n=t);n&&this[t](e,n)},r.onmousedown=function(t){this.pointerDown(t,t)},r.ontouchstart=function(t){this.pointerDown(t,t.changedTouches[0])},r.onpointerdown=function(t){this.pointerDown(t,t)};const s=['TEXTAREA','INPUT','SELECT','OPTION'],l=['radio','checkbox','button','submit','image','file'];return r.pointerDown=function(t,e){let n=s.includes(t.target.nodeName),i=l.includes(t.target.type),o=!n||i;!this.isPointerDown&&!t.button&&o&&(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY},this.bindActivePointerEvents(),this.emitEvent('pointerDown',[t,e]))},r.onmousemove=function(t){this.pointerMove(t,t)},r.onpointermove=function(t){this.withPointer('pointerMove',t)},r.ontouchmove=function(t){this.withTouch('pointerMove',t)},r.pointerMove=function(t,e){let n={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};this.emitEvent('pointerMove',[t,e,n]),!this.isDragging&&this.hasDragStarted(n)&&this.dragStart(t,e),this.isDragging&&this.dragMove(t,e,n)},r.hasDragStarted=function(t){return Math.abs(t.x)>3||Math.abs(t.y)>3},r.dragStart=function(t,e){this.isDragging=!0,this.isPreventingClicks=!0,this.emitEvent('dragStart',[t,e])},r.dragMove=function(t,e,n){this.emitEvent('dragMove',[t,e,n])},r.onmouseup=function(t){this.pointerUp(t,t)},r.onpointerup=function(t){this.withPointer('pointerUp',t)},r.ontouchend=function(t){this.withTouch('pointerUp',t)},r.pointerUp=function(t,e){this.pointerDone(),this.emitEvent('pointerUp',[t,e]),this.isDragging?this.dragEnd(t,e):this.staticClick(t,e)},r.dragEnd=function(t,e){this.isDragging=!1,setTimeout(()=>delete this.isPreventingClicks),this.emitEvent('dragEnd',[t,e])},r.pointerDone=function(){this.isPointerDown=!1,delete this.pointerIdentifier,this.unbindActivePointerEvents(),this.emitEvent('pointerDone')},r.onpointercancel=function(t){this.withPointer('pointerCancel',t)},r.ontouchcancel=function(t){this.withTouch('pointerCancel',t)},r.pointerCancel=function(t,e){this.pointerDone(),this.emitEvent('pointerCancel',[t,e])},r.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},r.staticClick=function(t,e){let n='mouseup'===t.type;n&&this.isIgnoringMouseUp||(this.emitEvent('staticClick',[t,e]),n&&(this.isIgnoringMouseUp=!0,setTimeout(()=>{delete this.isIgnoringMouseUp},400)))},n})}},n={};function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t['default']:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0})};var o={};return(()=>{"use strict";i.r(o),i.d(o,{default:()=>ai});var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}function r(t,e,i){return(e=n(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.r(t),i.d(t,{VERSION:()=>l,after:()=>Ve,all:()=>rn,allKeys:()=>bt,any:()=>sn,assign:()=>Vt,before:()=>Re,bind:()=>Me,bindAll:()=>De,chain:()=>Ee,chunk:()=>zn,clone:()=>zt,collect:()=>Qe,compact:()=>jn,compose:()=>Be,constant:()=>et,contains:()=>ln,countBy:()=>xn,create:()=>Wt,debounce:()=>Te,default:()=>Un,defaults:()=>Rt,defer:()=>Ae,delay:()=>je,detect:()=>Ye,difference:()=>Nn,drop:()=>Dn,each:()=>Ke,escape:()=>ue,every:()=>rn,extend:()=>Bt,extendOwn:()=>Vt,filter:()=>nn,find:()=>Ye,findIndex:()=>He,findKey:()=>We,findLastIndex:()=>Fe,findWhere:()=>Ge,first:()=>On,flatten:()=>An,foldl:()=>tn,foldr:()=>en,forEach:()=>Ke,functions:()=>It,get:()=>qt,groupBy:()=>bn,has:()=>Xt,head:()=>On,identity:()=>Yt,include:()=>ln,includes:()=>ln,indexBy:()=>wn,indexOf:()=>qe,initial:()=>Pn,inject:()=>tn,intersection:()=>Bn,invert:()=>Tt,invoke:()=>cn,isArguments:()=>Q,isArray:()=>Y,isArrayBuffer:()=>J,isBoolean:()=>j,isDataView:()=>X,isDate:()=>L,isElement:()=>A,isEmpty:()=>dt,isEqual:()=>yt,isError:()=>V,isFinite:()=>Z,isFunction:()=>H,isMap:()=>Ot,isMatch:()=>ht,isNaN:()=>tt,isNull:()=>D,isNumber:()=>I,isObject:()=>O,isRegExp:()=>B,isSet:()=>kt,isString:()=>T,isSymbol:()=>R,isTypedArray:()=>lt,isUndefined:()=>k,isWeakMap:()=>Dt,isWeakSet:()=>jt,iteratee:()=>te,keys:()=>ut,last:()=>kn,lastIndexOf:()=>Xe,map:()=>Qe,mapObject:()=>ne,matcher:()=>Gt,matches:()=>Gt,max:()=>dn,memoize:()=>ke,methods:()=>It,min:()=>hn,mixin:()=>Fn,negate:()=>Le,noop:()=>ie,now:()=>le,object:()=>Jn,omit:()=>Mn,once:()=>Je,pairs:()=>Nt,partial:()=>_e,partition:()=>En,pick:()=>_n,pluck:()=>an,property:()=>Kt,propertyOf:()=>oe,random:()=>se,range:()=>Wn,reduce:()=>tn,reduceRight:()=>en,reject:()=>on,rest:()=>Dn,restArguments:()=>P,result:()=>be,sample:()=>mn,select:()=>nn,shuffle:()=>gn,size:()=>Sn,some:()=>sn,sortBy:()=>vn,sortedIndex:()=>Ue,tail:()=>Dn,take:()=>On,tap:()=>Ht,template:()=>ye,templateSettings:()=>he,throttle:()=>Ne,times:()=>re,toArray:()=>pn,toPath:()=>Ft,transpose:()=>Vn,unescape:()=>de,union:()=>Ln,uniq:()=>In,unique:()=>In,uniqueId:()=>xe,unzip:()=>Vn,values:()=>At,where:()=>un,without:()=>Tn,wrap:()=>Ie,zip:()=>Rn});var s=i(453),l='1.13.7',c='object'==typeof self&&self.self===self&&self||'object'==typeof global&&global.global===global&&global||Function('return this')()||{},a=Array.prototype,u=Object.prototype,d='undefined'!=typeof Symbol?Symbol.prototype:null,h=a.push,f=a.slice,p=u.toString,m=u.hasOwnProperty,g='undefined'!=typeof ArrayBuffer,v='undefined'!=typeof DataView,y=Array.isArray,b=Object.keys,w=Object.create,x=g&&ArrayBuffer.isView,E=isNaN,S=isFinite,C=!{toString:null}.propertyIsEnumerable('toString'),_=['valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'],M=Math.pow(2,53)-1;function P(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),o=0;o<n;o++)i[o]=arguments[o+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var r=Array(e+1);for(o=0;o<e;o++)r[o]=arguments[o];return r[e]=i,t.apply(this,r)}}function O(t){var e=typeof t;return'function'===e||'object'===e&&!!t}function D(t){return null===t}function k(t){return void 0===t}function j(t){return!0===t||!1===t||'[object Boolean]'===p.call(t)}function A(t){return!(!t||1!==t.nodeType)}function N(t){var e='[object '+t+']';return function(t){return p.call(t)===e}}const T=N('String'),I=N('Number'),L=N('Date'),B=N('RegExp'),V=N('Error'),R=N('Symbol'),J=N('ArrayBuffer');var W=N('Function'),z=c.document&&c.document.childNodes;1&&'object'!=typeof Int8Array&&'function'!=typeof z&&(W=function(t){return'function'==typeof t||!1});const H=W,F=N('Object');var U=v&&(!/\[native code\]/.test(String(DataView))||F(new DataView(new ArrayBuffer(8)))),$='undefined'!=typeof Map&&F(new Map),q=N('DataView');const X=U?function(t){return null!=t&&H(t.getInt8)&&J(t.buffer)}:q,Y=y||N('Array');function G(t,e){return null!=t&&m.call(t,e)}var K=N('Arguments');!function(){K(arguments)||(K=function(t){return G(t,'callee')})}();const Q=K;function Z(t){return!R(t)&&S(t)&&!isNaN(parseFloat(t))}function tt(t){return I(t)&&E(t)}function et(t){return function(){return t}}function nt(t){return function(e){var n=t(e);return'number'==typeof n&&n>=0&&n<=M}}function it(t){return function(e){return null==e?void 0:e[t]}}const ot=it('byteLength'),rt=nt(ot);var st=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;const lt=g?function(t){return x?x(t)&&!X(t):rt(t)&&st.test(p.call(t))}:et(!1),ct=it('length');function at(t,e){e=function(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=_.length,i=t.constructor,o=H(i)&&i.prototype||u,r='constructor';for(G(t,r)&&!e.contains(r)&&e.push(r);n--;)(r=_[n])in t&&t[r]!==o[r]&&!e.contains(r)&&e.push(r)}function ut(t){if(!O(t))return[];if(b)return b(t);var e=[];for(var n in t)G(t,n)&&e.push(n);return C&&at(t,e),e}function dt(t){if(null==t)return!0;var e=ct(t);return'number'==typeof e&&(Y(t)||T(t)||Q(t))?0===e:0===ct(ut(t))}function ht(t,e){var n=ut(e),i=n.length;if(null==t)return!i;for(var o=Object(t),r=0;r<i;r++){var s=n[r];if(e[s]!==o[s]||!(s in o))return!1}return!0}function ft(t){return t instanceof ft?t:this instanceof ft?void(this._wrapped=t):new ft(t)}function pt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,ot(t))}ft.VERSION=l,ft.prototype.value=function(){return this._wrapped},ft.prototype.valueOf=ft.prototype.toJSON=ft.prototype.value,ft.prototype.toString=function(){return String(this._wrapped)};var mt='[object DataView]';function gt(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return('function'===o||'object'===o||'object'==typeof e)&&vt(t,e,n,i)}function vt(t,e,n,i){t instanceof ft&&(t=t._wrapped),e instanceof ft&&(e=e._wrapped);var o=p.call(t);if(o!==p.call(e))return!1;if(U&&'[object Object]'==o&&X(t)){if(!X(e))return!1;o=mt}switch(o){case'[object RegExp]':case'[object String]':return''+t==''+e;case'[object Number]':return+t!=+t?+e!=+e:0===+t?1/+t==1/e:+t===+e;case'[object Date]':case'[object Boolean]':return+t===+e;case'[object Symbol]':return d.valueOf.call(t)===d.valueOf.call(e);case'[object ArrayBuffer]':case mt:return vt(pt(t),pt(e),n,i)}var r='[object Array]'===o;if(!r&&lt(t)){if(ot(t)!==ot(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;r=!0}if(!r){if('object'!=typeof t||'object'!=typeof e)return!1;var s=t.constructor,l=e.constructor;if(s!==l&&!(H(s)&&s instanceof s&&H(l)&&l instanceof l)&&'constructor'in t&&'constructor'in e)return!1}i=i||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),r){if((c=t.length)!==e.length)return!1;for(;c--;)if(!gt(t[c],e[c],n,i))return!1}else{var a,u=ut(t);if(c=u.length,ut(e).length!==c)return!1;for(;c--;)if(!G(e,a=u[c])||!gt(t[a],e[a],n,i))return!1}return n.pop(),i.pop(),!0}function yt(t,e){return gt(t,e)}function bt(t){if(!O(t))return[];var e=[];for(var n in t)e.push(n);return C&&at(t,e),e}function wt(t){var e=ct(t);return function(n){if(null==n)return!1;var i=bt(n);if(ct(i))return!1;for(var o=0;o<e;o++)if(!H(n[t[o]]))return!1;return t!==Mt||!H(n[xt])}}var xt='forEach',Et='has',St=['clear','delete'],Ct=['get',Et,'set'],_t=St.concat(xt,Ct),Mt=St.concat(Ct),Pt=['add'].concat(St,xt,Et);const Ot=$?wt(_t):N('Map'),Dt=$?wt(Mt):N('WeakMap'),kt=$?wt(Pt):N('Set'),jt=N('WeakSet');function At(t){for(var e=ut(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=t[e[o]];return i}function Nt(t){for(var e=ut(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=[e[o],t[e[o]]];return i}function Tt(t){for(var e={},n=ut(t),i=0,o=n.length;i<o;i++)e[t[n[i]]]=n[i];return e}function It(t){var e=[];for(var n in t)H(t[n])&&e.push(n);return e.sort()}function Lt(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var o=1;o<i;o++)for(var r=arguments[o],s=t(r),l=s.length,c=0;c<l;c++){var a=s[c];e&&void 0!==n[a]||(n[a]=r[a])}return n}}const Bt=Lt(bt),Vt=Lt(ut),Rt=Lt(bt,!0);function Jt(t){if(!O(t))return{};if(w)return w(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function Wt(t,e){var n=Jt(t);return e&&Vt(n,e),n}function zt(t){return O(t)?Y(t)?t.slice():Bt({},t):t}function Ht(t,e){return e(t),t}function Ft(t){return Y(t)?t:[t]}function Ut(t){return ft.toPath(t)}function $t(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function qt(t,e,n){var i=$t(t,Ut(e));return k(i)?n:i}function Xt(t,e){for(var n=(e=Ut(e)).length,i=0;i<n;i++){var o=e[i];if(!G(t,o))return!1;t=t[o]}return!!n}function Yt(t){return t}function Gt(t){return t=Vt({},t),function(e){return ht(e,t)}}function Kt(t){return t=Ut(t),function(e){return $t(e,t)}}function Qt(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)}}return function(){return t.apply(e,arguments)}}function Zt(t,e,n){return null==t?Yt:H(t)?Qt(t,e,n):O(t)&&!Y(t)?Gt(t):Kt(t)}function te(t,e){return Zt(t,e,1/0)}function ee(t,e,n){return ft.iteratee!==te?ft.iteratee(t,e):Zt(t,e,n)}function ne(t,e,n){e=ee(e,n);for(var i=ut(t),o=i.length,r={},s=0;s<o;s++){var l=i[s];r[l]=e(t[l],l,t)}return r}function ie(){}function oe(t){return null==t?ie:function(e){return qt(t,e)}}function re(t,e,n){var i=Array(Math.max(0,t));e=Qt(e,n,1);for(var o=0;o<t;o++)i[o]=e(o);return i}function se(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}ft.toPath=Ft,ft.iteratee=te;const le=Date.now||function(){return(new Date).getTime()};function ce(t){var e=function(e){return t[e]},n='(?:'+ut(t).join('|')+')',i=RegExp(n),o=RegExp(n,'g');return function(t){return t=null==t?'':''+t,i.test(t)?t.replace(o,e):t}}const ae={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','`':'&#x60;'},ue=ce(ae),de=ce(Tt(ae)),he=ft.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var fe=/(.)^/,pe={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'},me=/\\|'|\r|\n|\u2028|\u2029/g;function ge(t){return'\\'+pe[t]}var ve=/^\s*(\w|\$)+\s*$/;function ye(t,e,n){!e&&n&&(e=n),e=Rt({},e,ft.templateSettings);var i=RegExp([(e.escape||fe).source,(e.interpolate||fe).source,(e.evaluate||fe).source].join('|')+'|$','g'),o=0,r="__p+='";t.replace(i,function(e,n,i,s,l){return r+=t.slice(o,l).replace(me,ge),o=l+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e}),r+="';\n";var s,l=e.variable;if(l){if(!ve.test(l))throw new Error('variable is not a bare identifier: '+l)}else r='with(obj||{}){\n'+r+'}\n',l='obj';r="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+r+'return __p;\n';try{s=new Function(l,'_',r)}catch(t){throw t.source=r,t}var c=function(t){return s.call(this,t,ft)};return c.source='function('+l+'){\n'+r+'}',c}function be(t,e,n){var i=(e=Ut(e)).length;if(!i)return H(n)?n.call(t):n;for(var o=0;o<i;o++){var r=null==t?void 0:t[e[o]];void 0===r&&(r=n,o=i),t=H(r)?r.call(t):r}return t}var we=0;function xe(t){var e=++we+'';return t?t+e:e}function Ee(t){var e=ft(t);return e._chain=!0,e}function Se(t,e,n,i,o){if(!(i instanceof e))return t.apply(n,o);var r=Jt(t.prototype),s=t.apply(r,o);return O(s)?s:r}var Ce=P(function(t,e){var n=Ce.placeholder,i=function(){for(var o=0,r=e.length,s=Array(r),l=0;l<r;l++)s[l]=e[l]===n?arguments[o++]:e[l];for(;o<arguments.length;)s.push(arguments[o++]);return Se(t,i,this,this,s)};return i});Ce.placeholder=ft;const _e=Ce,Me=P(function(t,e,n){if(!H(t))throw new TypeError('Bind must be called on a function');var i=P(function(o){return Se(t,i,e,this,n.concat(o))});return i}),Pe=nt(ct);function Oe(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var o=i.length,r=0,s=ct(t);r<s;r++){var l=t[r];if(Pe(l)&&(Y(l)||Q(l)))if(e>1)Oe(l,e-1,n,i),o=i.length;else for(var c=0,a=l.length;c<a;)i[o++]=l[c++];else n||(i[o++]=l)}return i}const De=P(function(t,e){var n=(e=Oe(e,!1,!1)).length;if(n<1)throw new Error('bindAll must be passed function names');for(;n--;){var i=e[n];t[i]=Me(t[i],t)}return t});function ke(t,e){var n=function(i){var o=n.cache,r=''+(e?e.apply(this,arguments):i);return G(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return n.cache={},n}const je=P(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),Ae=_e(je,ft,1);function Ne(t,e,n){var i,o,r,s,l=0;n||(n={});var c=function(){l=!1===n.leading?0:le(),i=null,s=t.apply(o,r),i||(o=r=null)},a=function(){var a=le();l||!1!==n.leading||(l=a);var u=e-(a-l);return o=this,r=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),l=a,s=t.apply(o,r),i||(o=r=null)):i||!1===n.trailing||(i=setTimeout(c,u)),s};return a.cancel=function(){clearTimeout(i),l=0,i=o=r=null},a}function Te(t,e,n){var i,o,r,s,l,c=function(){var a=le()-o;e>a?i=setTimeout(c,e-a):(i=null,n||(s=t.apply(l,r)),i||(r=l=null))},a=P(function(a){return l=this,r=a,o=le(),i||(i=setTimeout(c,e),n&&(s=t.apply(l,r))),s});return a.cancel=function(){clearTimeout(i),i=r=l=null},a}function Ie(t,e){return _e(e,t)}function Le(t){return function(){return!t.apply(this,arguments)}}function Be(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}}function Ve(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function Re(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}const Je=_e(Re,2);function We(t,e,n){e=ee(e,n);for(var i,o=ut(t),r=0,s=o.length;r<s;r++)if(e(t[i=o[r]],i,t))return i}function ze(t){return function(e,n,i){n=ee(n,i);for(var o=ct(e),r=t>0?0:o-1;r>=0&&r<o;r+=t)if(n(e[r],r,e))return r;return-1}}const He=ze(1),Fe=ze(-1);function Ue(t,e,n,i){for(var o=(n=ee(n,i,1))(e),r=0,s=ct(t);r<s;){var l=Math.floor((r+s)/2);n(t[l])<o?r=l+1:s=l}return r}function $e(t,e,n){return function(i,o,r){var s=0,l=ct(i);if('number'==typeof r)t>0?s=r>=0?r:Math.max(r+l,s):l=r>=0?Math.min(r+1,l):r+l+1;else if(n&&r&&l)return i[r=n(i,o)]===o?r:-1;if(o!=o)return(r=e(f.call(i,s,l),tt))>=0?r+s:-1;for(r=t>0?s:l-1;r>=0&&r<l;r+=t)if(i[r]===o)return r;return-1}}const qe=$e(1,He,Ue),Xe=$e(-1,Fe);function Ye(t,e,n){var i=(Pe(t)?He:We)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function Ge(t,e){return Ye(t,Gt(e))}function Ke(t,e,n){var i,o;if(e=Qt(e,n),Pe(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else{var r=ut(t);for(i=0,o=r.length;i<o;i++)e(t[r[i]],r[i],t)}return t}function Qe(t,e,n){e=ee(e,n);for(var i=!Pe(t)&&ut(t),o=(i||t).length,r=Array(o),s=0;s<o;s++){var l=i?i[s]:s;r[s]=e(t[l],l,t)}return r}function Ze(t){return function(e,n,i,o){var r=arguments.length>=3;return function(e,n,i,o){var r=!Pe(e)&&ut(e),s=(r||e).length,l=t>0?0:s-1;for(o||(i=e[r?r[l]:l],l+=t);l>=0&&l<s;l+=t){var c=r?r[l]:l;i=n(i,e[c],c,e)}return i}(e,Qt(n,o,4),i,r)}}const tn=Ze(1),en=Ze(-1);function nn(t,e,n){var i=[];return e=ee(e,n),Ke(t,function(t,n,o){e(t,n,o)&&i.push(t)}),i}function on(t,e,n){return nn(t,Le(ee(e)),n)}function rn(t,e,n){e=ee(e,n);for(var i=!Pe(t)&&ut(t),o=(i||t).length,r=0;r<o;r++){var s=i?i[r]:r;if(!e(t[s],s,t))return!1}return!0}function sn(t,e,n){e=ee(e,n);for(var i=!Pe(t)&&ut(t),o=(i||t).length,r=0;r<o;r++){var s=i?i[r]:r;if(e(t[s],s,t))return!0}return!1}function ln(t,e,n,i){return Pe(t)||(t=At(t)),('number'!=typeof n||i)&&(n=0),qe(t,e,n)>=0}const cn=P(function(t,e,n){var i,o;return H(e)?o=e:(e=Ut(e),i=e.slice(0,-1),e=e[e.length-1]),Qe(t,function(t){var r=o;if(!r){if(i&&i.length&&(t=$t(t,i)),null==t)return;r=t[e]}return null==r?r:r.apply(t,n)})});function an(t,e){return Qe(t,Kt(e))}function un(t,e){return nn(t,Gt(e))}function dn(t,e,n){var i,o,r=-1/0,s=-1/0;if(null==e||'number'==typeof e&&'object'!=typeof t[0]&&null!=t)for(var l=0,c=(t=Pe(t)?t:At(t)).length;l<c;l++)null!=(i=t[l])&&i>r&&(r=i);else e=ee(e,n),Ke(t,function(t,n,i){((o=e(t,n,i))>s||o===-1/0&&r===-1/0)&&(r=t,s=o)});return r}function hn(t,e,n){var i,o,r=1/0,s=1/0;if(null==e||'number'==typeof e&&'object'!=typeof t[0]&&null!=t)for(var l=0,c=(t=Pe(t)?t:At(t)).length;l<c;l++)null!=(i=t[l])&&i<r&&(r=i);else e=ee(e,n),Ke(t,function(t,n,i){((o=e(t,n,i))<s||o===1/0&&r===1/0)&&(r=t,s=o)});return r}var fn=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function pn(t){return t?Y(t)?f.call(t):T(t)?t.match(fn):Pe(t)?Qe(t,Yt):At(t):[]}function mn(t,e,n){if(null==e||n)return Pe(t)||(t=At(t)),t[se(t.length-1)];var i=pn(t),o=ct(i);e=Math.max(Math.min(e,o),0);for(var r=o-1,s=0;s<e;s++){var l=se(s,r),c=i[s];i[s]=i[l],i[l]=c}return i.slice(0,e)}function gn(t){return mn(t,1/0)}function vn(t,e,n){var i=0;return e=ee(e,n),an(Qe(t,function(t,n,o){return{value:t,index:i++,criteria:e(t,n,o)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),'value')}function yn(t,e){return function(n,i,o){var r=e?[[],[]]:{};return i=ee(i,o),Ke(n,function(e,o){var s=i(e,o,n);t(r,e,s)}),r}}const bn=yn(function(t,e,n){G(t,n)?t[n].push(e):t[n]=[e]}),wn=yn(function(t,e,n){t[n]=e}),xn=yn(function(t,e,n){G(t,n)?t[n]++:t[n]=1}),En=yn(function(t,e,n){t[n?0:1].push(e)},!0);function Sn(t){return null==t?0:Pe(t)?t.length:ut(t).length}function Cn(t,e,n){return e in n}const _n=P(function(t,e){var n={},i=e[0];if(null==t)return n;H(i)?(e.length>1&&(i=Qt(i,e[1])),e=bt(t)):(i=Cn,e=Oe(e,!1,!1),t=Object(t));for(var o=0,r=e.length;o<r;o++){var s=e[o],l=t[s];i(l,s,t)&&(n[s]=l)}return n}),Mn=P(function(t,e){var n,i=e[0];return H(i)?(i=Le(i),e.length>1&&(n=e[1])):(e=Qe(Oe(e,!1,!1),String),i=function(t,n){return!ln(e,n)}),_n(t,i,n)});function Pn(t,e,n){return f.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function On(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Pn(t,t.length-e)}function Dn(t,e,n){return f.call(t,null==e||n?1:e)}function kn(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:Dn(t,Math.max(0,t.length-e))}function jn(t){return nn(t,Boolean)}function An(t,e){return Oe(t,e,!1)}const Nn=P(function(t,e){return e=Oe(e,!0,!0),nn(t,function(t){return!ln(e,t)})}),Tn=P(function(t,e){return Nn(t,e)});function In(t,e,n,i){j(e)||(i=n,n=e,e=!1),null!=n&&(n=ee(n,i));for(var o=[],r=[],s=0,l=ct(t);s<l;s++){var c=t[s],a=n?n(c,s,t):c;e&&!n?(s&&r===a||o.push(c),r=a):n?ln(r,a)||(r.push(a),o.push(c)):ln(o,c)||o.push(c)}return o}const Ln=P(function(t){return In(Oe(t,!0,!0))});function Bn(t){for(var e=[],n=arguments.length,i=0,o=ct(t);i<o;i++){var r=t[i];if(!ln(e,r)){var s;for(s=1;s<n&&ln(arguments[s],r);s++);s===n&&e.push(r)}}return e}function Vn(t){for(var e=t&&dn(t,ct).length||0,n=Array(e),i=0;i<e;i++)n[i]=an(t,i);return n}const Rn=P(Vn);function Jn(t,e){for(var n={},i=0,o=ct(t);i<o;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n}function Wn(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),r=0;r<i;r++,t+=n)o[r]=t;return o}function zn(t,e){if(null==e||e<1)return[];for(var n=[],i=0,o=t.length;i<o;)n.push(f.call(t,i,i+=e));return n}function Hn(t,e){return t._chain?ft(e).chain():e}function Fn(t){return Ke(It(t),function(e){var n=ft[e]=t[e];ft.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),Hn(this,n.apply(ft,t))}}),ft}Ke(['pop','push','reverse','shift','sort','splice','unshift'],function(t){var e=a[t];ft.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),'shift'!==t&&'splice'!==t||0!==n.length||delete n[0]),Hn(this,n)}}),Ke(['concat','join','slice'],function(t){var e=a[t];ft.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Hn(this,t)}});const Un=ft;var $n=Fn(t);$n._=$n;const qn=$n,Xn=t=>{let e=!1;do{e=e?e.parent():t.parent()}while(e&&!e.get('selectable'));return e},Yn=t=>{let e=!1;do{e=e?e.getChildAt(0):t.getChildAt(0)}while(e&&!e.get('selectable'));return e},Gn=s.View.extend({template:qn.template("\n        <% \n        actionClass = ( typeof model.class === 'function' ) ? model.class() : model.class \n        actionValue = ( typeof model.value === 'function' ) ? model.value() : model.value\n        actionLabel = ( typeof model.label === 'function' ) ? model.label() : model.label\n        actionTitleTooltip = ( typeof model.titleTooltip === 'function' ) ? model.titleTooltip() : model.titleTooltip\n        %>\n        <% if(model.type == 'button'){ %>\n            <button class=\"gcm-item gcm-item-button <%= actionClass %>\" title=\"<%= actionTitleTooltip %>\"><%= actionLabel %></button>\n        <% } %>\n        <% if(model.type == 'range'){ %>\n            <span class=\"gcm-range-output\"><%= actionValue %></div>\n        <% } %>\n        <% if(model.type == 'color'){ %>\n            <button class=\"gcm-item gcm-item-color <%= actionClass %>\">\n                <span style=\"background-color:<%= actionValue %>\"></span>\n            </button>\n        <% } %>\n        <% if(model.type == 'message'){ %>\n            <div class=\"gcm-item <%= actionClass %>\"><%= actionLabel %></div>\n        <% } %>\n        <% if(model.type == 'custom'){ %>\n            <% print( model.content ) %>\n        <% } %>\n        <% if(model.type == 'toggle'){ \n            actionClass += ( model.isOpen) ? ' active' : ''\n            %>\n            <button class=\"gcm-item gcm-item-toggle <%= actionClass %>\" title=\"More\"><i class=\"bi bi-arrow-down\"></i></button>\n        <% } %>\n        <% if(model.type == 'input'){ %>\n            <input class=\"gcm-item gcm-item-input <%= actionClass %>\" type=\"<%= model.inputType %>\" value=\"<%= actionValue %>\" min=\"<%= model.min %>\" max=\"<%= model.max %>\" />\n        <% } %>\n    "),initialize:function(){this.render()},render:function(){const t=this.model.toJSON();return this.$el.html(this.template({model:t})),this}}),Kn=s.View.extend({template:qn.template("\n        <% \n        actionClass = ( typeof model.class === 'function' ) ? model.class() : model.class \n        actionValue = ( typeof model.value === 'function' ) ? model.value() : model.value\n        actionTitle = ( model.title && typeof model.title === 'object' ) ? model.title.label : model.title\n        %>\n        <% if(actionTitle){ %>\n            <% if(typeof model.title === 'object' && 'position' in model.title) print('<div class=\"title-'+ model.title.position +'\">') %>\n                <h5><span><%= actionTitle %></span></h5>\n        <% } %>\n\n        <% if(model.type == 'range'){ %>\n            <div class=\"gcm-item gcm-range-wrapper <%= actionClass %>\">\n                <input type=\"range\" min=\"<%= model.min %>\" max=\"<%= model.max %>\" value=\"<%= actionValue %>\">\n                <div class=\"form-element\"></div>\n            </div>\n        <% } else { %>\n            <div class=\"form-element\"></div>\n        <% } %>\n        \n        <% if(actionTitle && typeof model.title === 'object' && 'position' in model.title) print('</div>') %>\n    "),initialize:function(){this.render()},render:function(){const t=this.model.toJSON();this.$el.html(this.template({model:t,cid:this.model.cid})),this.renderFormElement(),t.title&&'object'==typeof t.title&&'position'in t.title&&this.el.classList.add("title-"+t.title.position),'function'==typeof t.onOpen&&t.onOpen(this.el)},renderFormElement:function(){const t=this.model.toJSON();let e=new Gn({model:this.model});this.el.querySelector('.form-element').replaceChildren(e.el),this.el.style.display=1==t.active?'block':'none'},update:function(){this.renderFormElement()},events:{'click .gcm-item-button':'handleButtonClick','click .gcm-item-color':'handleColorClick','click .gcm-item-toggle':'handleToggleClick','input input[type="range"]':'handleRangeDrag','change input[type="range"]':'handleRangeDragEnd','change input[type="number"]':'handleInputNumber','change input[type="text"]':'handleInput'},handleButtonClick(t){t.preventDefault();const{command:e,args:n,editor:i}=this.model.toJSON();i.contextMenu.colorPicker.hide(),e&&(n.component=i.contextMenu.model.get('selected'),i.runCommand(e,n),this.checkRerender())},handleColorClick(t){t.preventDefault();const{command:e,args:n,value:i,editor:o}=this.model.toJSON();if(e){const r=t=>{n.value=t,n.component=o.contextMenu.model.get('selected'),this.model.set('value',t),o.runCommand(e,n)};o.contextMenu.colorPicker.getView().handleVisibility(i,r,t.target,n)}},handleRangeDrag(t){t.preventDefault();const{command:e,args:n,editor:i}=this.model.toJSON();i.contextMenu.colorPicker.hide();t.target.parentNode.querySelector('.gcm-range-output').textContent=t.target.value,e&&(n.component=i.contextMenu.model.get('selected'),n.value=t.target.value,i.runCommand(e,n))},handleRangeDragEnd(t){t.preventDefault();const{command:e,args:n,editor:i}=this.model.toJSON();e&&i.Commands.has(e+':end')&&(n.component=i.contextMenu.model.get('selected'),n.value=t.target.value,i.runCommand(e+':end',n))},handleToggleClick(t){t.preventDefault();const{editor:e,isOpen:n}=this.model.toJSON();e.contextMenu.colorPicker.hide(),this.model.set('isOpen',!n);var i=this.model.collection.indexOf(this.model);this.model.collection.forEach((t,e)=>{if(e>i){let e=!n;t.set('active',e)}}),e.contextMenu.trigger('update:view')},handleInput(t){t.preventDefault();const{command:e,args:n,editor:i}=this.model.toJSON();i.contextMenu.colorPicker.hide();const o=t.target.value;e&&(n.component=i.contextMenu.model.get('selected'),n.value=o,i.runCommand(e,n),this.checkRerender())},updateOnEnter(t){13==t.keyCode&&this.handleInput(t)},handleInputNumber(t){t.preventDefault();const{command:e,min:n,max:i,editor:o}=this.model.toJSON();o.contextMenu.colorPicker.hide();const r=t.target.value;e&&r>=n&&r<=i?this.handleInput(t):alert('Value not allowed')},checkRerender(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!1},{rerender:e,editor:n}=this.model.toJSON();if(e='boolean'==typeof e?{partial:e,full:!1}:e,t.force&&(e={partial:!1,full:!0}),e.full||e.partial){const t=e.full?'rerender:actions':'rerender:view';n.contextMenu.trigger(t)}}}),Qn=s.View.extend({el:'.gcm__actions',initialize:function(){this.render()},render:function(){this.$el.html('');let t=document.createElement('div');const{actions:e}=this.model.toJSON();e.forEach(e=>{if('options'==e.get('type'))this.handleGroupedActions(e,t);else{const n=this.instantiateActionView(e);t.append(n.el)}}),this.$el.append(t)},instantiateActionView(t){const e=new Kn({model:t});return t.set('__view',e),e},handleGroupedActions(t,e){const n=t.toJSON();let i=document.createElement('div');if(i.className="gcm-distribute-box-wrapper",n.title){let t=document.createElement('h5'),e=document.createTextNode(n.title);t.appendChild(e),i.append(t)}let o=[[]];n.models.forEach(t=>{const e=t.get('type');'break'!=e&&o.at(-1).push(t),'break'!=e&&'toggle'!=e||o.push([])});let r=!1,s=!1;o.forEach((t,e)=>{let o=document.createElement('div');o.className="gcm-distribute-box",n.class&&o.classList.add(n.class),n.gap&&(o.style.gap=n.gap+'px'),t.forEach(t=>{const e=t.get('type');if('options'==e)this.handleGroupedActions(t,o);else{'toggle'==e&&(r=!0,s=t.get('isOpen')),r&&'toggle'!=e&&t.set('active',s);const n=this.instantiateActionView(t);o.append(n.el)}}),i.append(o)}),e.append(i)}}),Zn=s.View.extend({el:'.gcm__header',template:qn.template("\n        <div class=\"gcm__header__row\">\n            <div class=\"gcm__header__title\"><%= componentName %></div>\n            <div class=\"gcm__header__actions\">\n                <button class=\"gcm-open-datastore\" title=\"Open Datastore\"><i class=\"bi bi-database\"></i></button>\n                <button class=\"gcm-open-style-manager\" title=\"Style Manager\"><i class=\"bi bi-pencil\"></i></button>\n                <% if(isCopiable){ %>\n                    <button class=\"gcm-clone\" title=\"Duplicate\"><i class=\"bi bi-files\"></i></button>\n                <% } %>\n                <button class=\"gcm-copy-styles\" title=\"Copy styles\"><i class=\"bi bi-box-arrow-right\"></i></button>\n                <button class=\"gcm-paste-styles <%= clipboardClass %>\" title=\"Paste styles\"><i class=\"bi bi-box-arrow-in-left\"></i></button>\n                <% if(isRemovable){ %>\n                    <button class=\"gcm-delete\" title=\"Delete\"><i class=\"bi bi-trash\"></i></button>\n                <% } %>\n                <button class=\"gcm-close\" title=\"Close\"><i class=\"bi bi-x-circle\"></i></button>\n            </div>\n        </div>\n        <div class=\"gcm__header__row breadcrumbs-wrapper\">\n            <div class=\"gcm__header__breadcrumbs\">\n                <p>\n                <% breadcrumbs.forEach( (c,i) => {\n                    isLast = ( (i+1) == breadcrumbs.length ) ? true : false;\n                    if( !isLast ) print( '<a href=\"#\" title=\"'+c.name+'\" class=\"'+c.class+'\">' )\n                    print( c.name )\n                    if( !isLast ) print( '</a> > ' )\n                }) %>\n                </p>\n            </div>\n            <div class=\"gcm__header__actions\">\n                <% if(hasSelectableParent){ %>\n                    <button class=\"gcm-select-parent\" title=\"Select parent\"><i class=\"bi bi-arrow-up\"></i></button>\n                <% } %>\n                <% if(hasSelectableChild){ %>\n                    <button class=\"gcm-select-child\" title=\"Select child\"><i class=\"bi bi-arrow-down\"></i></button>\n                <% } %>\n            </div>\n        </div>\n    "),initialize:function(){this.render()},render:function(){const{selected:t,clipboard:e}=this.model.toJSON(),n=!!t&&t.get('copyable'),i=!!t&&t.get('removable'),o=!!t&&Xn(t),r=!!t&&Yn(t),s=t?t.getName():'NoName';let l=[],c=o,a=!1;if(o){do{a=a?a.parent():c.parent()}while(a&&!a.get('selectable'));a&&l.push({name:a.getName(),class:'gcm-select-grandpa'}),l.push({name:c.getName(),class:'gcm-select-parent'})}l.push({name:s,class:''});let u=null!=e?'':'disabled';this.$el.html(this.template({selected:t,hasSelectableChild:r,hasSelectableParent:o,breadcrumbs:l,componentName:s,isCopiable:n,isRemovable:i,clipboardClass:u}))},events:{'click .gcm-open-datastore':'openDatastore','click .gcm-open-style-manager':'openStyleManager','click .gcm-select-grandpa':'selectGrandpa','click .gcm-select-parent':'selectParent','click .gcm-select-child':'selectChild','click .gcm-close':'close','click .gcm-delete':'deleteComponent','click .gcm-clone':'cloneComponent','click .gcm-copy-styles':'copyStyles','click .gcm-paste-styles':'pasteStyles'},selectGrandpa:function(t){t.preventDefault();const{editor:e,selected:n}=this.model.toJSON();e.contextMenu.colorPicker.hide(),e.runCommand('gcm-select-grandpa',{component:n})},selectParent:function(t){t.preventDefault();const{editor:e,selected:n}=this.model.toJSON();e.contextMenu.colorPicker.hide(),e.runCommand('gcm-select-parent',{component:n})},selectChild:function(t){t.preventDefault();const{editor:e,selected:n}=this.model.toJSON();e.contextMenu.colorPicker.hide(),e.runCommand('gcm-select-child',{component:n})},close:function(t){t.preventDefault();this.model.get('editor').runCommand('gcm-close',{})},openStyleManager:function(t){t.preventDefault();this.model.get('editor').runCommand('open-style-manager',{})},deleteComponent:function(t){t.preventDefault();const e=this.model.get('editor');e.contextMenu.colorPicker.hide(),e.runCommand('tlb-delete',{})},cloneComponent:function(t){t.preventDefault();const e=this.model.get('editor');e.contextMenu.colorPicker.hide(),e.runCommand('tlb-clone',{})},copyStyles:function(t){t.preventDefault();const e=this.model.get('editor');e.contextMenu.colorPicker.hide(),e.runCommand('gcm-copy-styles',{})},pasteStyles:function(t){t.preventDefault();const e=this.model.get('editor');e.contextMenu.colorPicker.hide(),e.runCommand('gcm-paste-styles',{})},openDatastore:function(t){t.preventDefault();this.model.get('editor').runCommand('open-datastore',{})}});var ti=i(36),ei=i.n(ti);const ni=s.View.extend({el:'#gjs-context-menu',template:qn.template("\n        <div class=\"gcm__header\"></div>\n        <div class=\"gcm__actions\"></div>\n        <div class=\"gcm__color-picker\"></div>\n    "),initialize:function(){const t=this.model.get('editor');t.on('trait:custom',()=>{this.prepare()}),t.on('style:custom',()=>{this.update()}),t.on('canvas:drop',()=>{t.contextMenu.view.closeContextMenu()},this),this.render()},render:function(){this.$el.html(this.template());const t=this.model.get('editor');this.model.set({iframe:t.Canvas.getFrameEl().contentDocument.body,canvas:t.Canvas.getElement(),headerView:new Zn({model:this.model}),actionsView:new Qn({model:this.model})}),this.handleDragFuncionality(),this.handleContextMenuEvent(),this.handleClickOutside()},prepare:function(){const{headerView:t,actionsView:e}=this.model.toJSON();t.render(),e.render()},update:function(){const{actions:t}=this.model.toJSON();this.updateActionsRecursive(t)},updateActionsRecursive(t){t.forEach(t=>{const e=t.get('type');var n;'options'==e?this.updateActionsRecursive(t.get('models')):'break'!=e&&(null===(n=t.get('__view'))||void 0===n||n.update())})},handleDragFuncionality(){const{iframe:t,canvas:e,headerView:n}=this.model.toJSON(),i=new(ei())(this.el,{containment:e,handle:n.el});i.on('dragMove',(e,n)=>{t.style.pointerEvents="none",this.el.classList.add('dragging')}),i.on('dragEnd',(e,n)=>{t.style.pointerEvents="initial",this.el.classList.remove('dragging')})},handleContextMenuEvent(){const{iframe:t,selected:e}=this.model.toJSON();t.addEventListener('contextmenu',t=>{this.closeContextMenu(),null!=e&&(t.preventDefault(),this.openContextMenu(t))},!1)},handleClickOutside(){const{iframe:t}=this.model.toJSON();t.addEventListener('click',t=>{this.closeContextMenu()},!1);document.querySelector("body").addEventListener('click',t=>{null!=t.target.offsetParent&&t.target.offsetParent!=this.el&&this.closeContextMenu()},!1)},openContextMenu(t){const{clientX:e,clientY:n}=t,{normalizedX:i,normalizedY:o}=this.normalizePosition(e,n);this.el.style.top="".concat(o,"px"),this.el.style.left="".concat(i,"px"),this.el.classList.add("visible"),this.model.set({active:!0})},closeContextMenu(){this.el.classList.remove("visible"),this.model.set({active:!1});this.model.get('editor').contextMenu.colorPicker.hide()},normalizePosition(t,e){const{canvas:n}=this.model.toJSON(),i=this.el;let o=t,r=e;const s=t+i.clientWidth>n.clientWidth,l=e+i.clientHeight>n.clientHeight;return s&&(o=n.clientWidth-i.clientWidth),l&&(r=n.clientHeight-i.clientHeight),{normalizedX:o,normalizedY:r}}}),ii=s.Model.extend({defaults:{type:'custom',label:'Action',command:null,title:null,rerender:{partial:!1,full:!1},args:{},active:!0,class:'',min:0,max:100,default:0,options:[],content:'',onOpen:null,inputType:'text',value:'',isOpen:!1,titleTooltip:''}});qn.extend(ii,s.Events);const oi=s.Model.extend({defaults:{active:!1,actions:[],editor:null,selected:null,clipboard:null},initialize:function(){const{editor:t}=this.toJSON();t.on('component:selected',t=>{this.set({selected:t})}),this.on('change:selected',this.populateActions,this),this.populateActions()},populateActions:function(){let t=[...this.getGlobalActions(),...this.getComponentActions()],e=this.get('actions');e.reset(),t.forEach(t=>{const n=this.instantiateAction(t);e.add(n),'options'==t.type&&this.handleInnerActions(n)})},getGlobalActions:()=>[],getComponentActions(){const{selected:t,options:e,editor:n}=this.toJSON();if(void 0===t)return[];const i=t.get('type');let o=[];'actions'in e&&i in e.actions&&'function'==typeof e.actions[i]&&(o=e.actions[i](t,n));let r=[],s=t.get('contextMenu')||[];return'function'==typeof s&&(r=s(t)),[...r,...o]},instantiateAction(t){const e=new ii(t);return e.set('editor',this.get('editor')),e},handleInnerActions(t){const e=new s.Collection;let n=t.get('options');n='function'==typeof n?n():n,n.forEach(t=>{const n=this.instantiateAction(t);e.add(n),'options'==t.type&&this.handleInnerActions(n)}),t.set('models',e)}}),ri=s.Collection.extend({model:ii,initialize:function(){}}),si=t=>{t.on('component:remove',e=>{t.contextMenu.model.get('selected').cid==e.cid&&(t.contextMenu.view.closeContextMenu(),t.contextMenu.model.set('selected',t.getWrapper()))})};function li(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function ci(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?li(Object(n),!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):li(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const ai=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=ci(ci({},{}),e);t.on('load',()=>{void 0===window.wp&&(()=>{var t='cssIcons';if(!document.getElementById(t)){console.log('Inserting CSS for icons','gjs-context-menu');var e=document.getElementsByTagName('head')[0],n=document.createElement('link');n.id=t,n.rel='stylesheet',n.type='text/css',n.href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css",n.media='all',e.appendChild(n)}})();const e=document.createElement('div');e.setAttribute("id","gjs-context-menu"),document.querySelector('.gjs-editor').append(e);const i=new oi({editor:t,options:n,actions:new ri,selected:t.getWrapper()});t.contextMenu={model:i,view:new ni({model:i})},qn.extend(t.contextMenu,s.Events),t.contextMenu.on('rerender:actions',function(t){this.model.populateActions(),this.model.get('actionsView').render()}),t.contextMenu.on('rerender:view',function(t){this.model.get('actionsView').render()}),t.contextMenu.on('update:view',function(t){this.view.update()}),function(t){const e=t.Commands;e.add('gcm-select-parent',function(t,e){let n=t.contextMenu.model.get('selected'),i=Xn(n);i&&t.select(i)}),e.add('gcm-select-grandpa',function(t,e){let n=t.contextMenu.model.get('selected'),i=Xn(n),o=!1;do{o=o?o.parent():i.parent()}while(o&&!o.get('selectable'));o&&t.select(o)}),e.add('gcm-select-child',function(t,e){let n=t.contextMenu.model.get('selected'),i=Yn(n);i&&t.select(i)}),e.add('gcm-close',function(t,e){t.contextMenu.view.closeContextMenu()}),e.add('gcm-copy-styles',function(t,e){let n={},i=t.contextMenu.model.get('selected');n.cmp=i,n.styles=i.getStyle(),t.contextMenu.model.set({clipboard:n})}),e.add('gcm-paste-styles',function(t,e){t.trigger('before:paste:styles');let n=t.contextMenu.model.get('selected'),i=t.contextMenu.model.get('clipboard').styles||{};(n.get('unstylable')||[]).forEach(t=>{delete i[t]}),n.addStyle(i)})}(t),(t=>{[si].map(e=>e(t))})(t),t.contextMenu.colorPicker=function(t){return function(){const e=s.Model.extend({defaults:{value:'#000000',onChange:null,active:!1,handle:null}}),n=s.View.extend({el:'.gcm__color-picker',className:'gcm-color-picker-wrapper',template:function(){return"<input type='text' class=\"gcm-color-picker\" />"},initialize:function(){this.model.on('change:value',this.setPickerColor,this),this.render(),this.initPicker()},render:function(){this.$el.html(this.template())},initPicker:function(){const e=this.el.querySelector('input'),n=t.getModel().initBaseColorPicker(e,{preferredFormat:"hex",showInput:!0,flat:!0,clickoutFiresChange:!1,showButtons:!1,allowEmpty:!0,move:t=>{this.onChangeColor(t)}});n.spectrum('container')[0].querySelector('.sp-input').addEventListener('change',()=>{const t=n.spectrum('get');this.onChangeColor(t)},!1),n.spectrum('container')[0].style.display="none",this.model.set({ui:n})},setPickerColor:function(){this.model.get('ui').spectrum("set",this.model.get('value'))},onChangeColor:function(t){let e='';t&&(e=t._a<1?t.toRgbString():t.toHexString());let n=this.model.get('onChange');'function'==typeof n&&n(e)},handleVisibility(t,e,n,i){let{active:o,ui:r,handleArgs:s}=this.model.toJSON();const l=r.spectrum('container')[0];this.model.set({value:t,onChange:e,handle:n,handleArgs:i}),o?s.property==i.property?(l.style.display='none',this.model.set({active:!1})):this.setPosition():(l.style.display='block',this.setPosition(),this.model.set({active:!0}))},setPosition(){let{ui:t,handle:e}=this.model.toJSON();const n=t.spectrum('container')[0],{top:i,left:o,height:r}=this.getPosition(e);n.style.position='absolute',n.style.top="".concat(i+r,"px"),n.style.left="".concat(o,"px")},getPosition(e){let n=t.contextMenu.view.el.getBoundingClientRect(),i=e.getBoundingClientRect(),o={};return o.top=i.top-n.top,o.right=i.right-n.right,o.bottom=i.bottom-n.bottom,o.left=i.left-n.left,o.height=i.height,o}});return{init:function(){const t=new e;return this.model=t,this.view=new n({model:t}),this},getView:function(){return this.view},hide:function(){let{active:t}=this.model.toJSON();if(t){let{ui:t}=this.model.toJSON();t.spectrum('container')[0].style.display='none',this.model.set({active:!1})}}}}().init()}(t)})}})(),o})());
//# sourceMappingURL=index.js.map